<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Глава 12: Тестирование | Android E-Commerce</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        pre { background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; }
        .keyword { color: #569cd6; }
        .function { color: #dcdcaa; }
        .string { color: #ce9178; }
        .comment { color: #6a9955; }
        .annotation { color: #4ec9b0; }
    </style>
</head>
<body class="bg-white dark:bg-zinc-900">
    <div class="max-w-4xl mx-auto px-6 py-12">
        <a href="../index.html" class="text-green-500 hover:underline mb-4 inline-block">&larr; Назад</a>
        <h1 class="text-4xl font-bold text-zinc-900 dark:text-white mb-6">Глава 12: Тестирование</h1>
        <div class="prose dark:prose-invert max-w-none">

            <h2 class="text-2xl font-bold mt-8 mb-4">Unit тесты ViewModel</h2>
            <pre><code><span class="keyword">class</span> HomeViewModelTest {
    <span class="keyword">private lateinit var</span> viewModel: HomeViewModel
    <span class="keyword">private lateinit var</span> fakeRepository: FakeProductRepository

    <span class="annotation">@Before</span>
    <span class="keyword">fun</span> <span class="function">setup</span>() {
        fakeRepository = FakeProductRepository()
        viewModel = HomeViewModel(GetProductsUseCase(fakeRepository))
    }

    <span class="annotation">@Test</span>
    <span class="keyword">fun</span> <span class="function">`loading products updates state`</span>() = runTest {
        viewModel.loadProducts()

        <span class="keyword">val</span> state = viewModel.uiState.value
        assertFalse(state.isLoading)
        assertEquals(<span class="number">2</span>, state.products.size)
    }
}</code></pre>

            <h2 class="text-2xl font-bold mt-8 mb-4">Fake Repository</h2>
            <pre><code><span class="keyword">class</span> FakeProductRepository : ProductRepository {
    <span class="keyword">private val</span> products = listOf(
        Product(id = <span class="number">1</span>, title = <span class="string">"iPhone"</span>, price = <span class="number">999.0</span>, ...),
        Product(id = <span class="number">2</span>, title = <span class="string">"MacBook"</span>, price = <span class="number">1999.0</span>, ...)
    )

    <span class="keyword">override fun</span> <span class="function">getProducts</span>() = flow {
        emit(Resource.Success(products))
    }
}</code></pre>

            <h2 class="text-2xl font-bold mt-8 mb-4">UI тесты Compose</h2>
            <pre><code><span class="keyword">class</span> ProductCardTest {
    <span class="annotation">@get:Rule</span>
    <span class="keyword">val</span> composeRule = createComposeRule()

    <span class="annotation">@Test</span>
    <span class="keyword">fun</span> <span class="function">`product card displays title and price`</span>() {
        <span class="keyword">val</span> product = Product(title = <span class="string">"iPhone"</span>, price = <span class="number">999.0</span>, ...)

        composeRule.setContent {
            ProductCard(product = product, onClick = {})
        }

        composeRule.onNodeWithText(<span class="string">"iPhone"</span>).assertIsDisplayed()
        composeRule.onNodeWithText(<span class="string">"$999"</span>).assertIsDisplayed()
    }
}</code></pre>

            <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-6 mt-8">
                <h3 class="font-semibold text-green-900 dark:text-green-100 mb-3">Типы тестов</h3>
                <ul class="text-green-800 dark:text-green-200 space-y-2">
                    <li>• <strong>Unit</strong> — ViewModel, UseCase, Repository</li>
                    <li>• <strong>Integration</strong> — Room DAO, API</li>
                    <li>• <strong>UI</strong> — Compose компоненты</li>
                </ul>
            </div>
        </div>
        <div class="flex justify-between items-center mt-12 pt-8 border-t border-zinc-200 dark:border-zinc-800">
            <a href="11-di-hilt.html" class="text-green-500 hover:underline">&larr; Hilt DI</a>
            <a href="../index.html" class="text-green-500 hover:underline">Оглавление</a>
            <a href="13-final.html" class="text-green-500 hover:underline">Финал &rarr;</a>
        </div>
    </div>
</body>
</html>
