<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–ª–∞–≤–∞ 7: –ü–æ–∏—Å–∫ | SwiftUI E-Commerce</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'media',
            theme: { extend: { colors: { primary: '#007AFF' } } }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/swift.min.js"></script>
    <style>
        ::-webkit-scrollbar { width: 6px; }
        pre code { font-size: 14px; line-height: 1.6; }
    </style>
</head>
<body class="bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100">
    <div class="min-h-screen">
        <header class="sticky top-0 z-40 bg-white/80 dark:bg-zinc-950/80 backdrop-blur-md border-b border-zinc-200 dark:border-zinc-800">
            <div class="max-w-4xl mx-auto px-6 py-4 flex items-center justify-between">
                <a href="../index.html" class="flex items-center gap-2 text-zinc-600 dark:text-zinc-400 hover:text-primary transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                    –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
                </a>
                <span class="text-sm text-zinc-500">–ì–ª–∞–≤–∞ 7</span>
            </div>
        </header>

        <main class="max-w-4xl mx-auto px-6 py-12">
            <article class="prose prose-zinc dark:prose-invert max-w-none">
                <span class="text-sm font-semibold text-primary uppercase tracking-wider">–ì–ª–∞–≤–∞ 7</span>
                <h1 class="text-4xl font-bold mt-2 mb-8">–ü–æ–∏—Å–∫</h1>

                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-6 mb-8">
                    <h3 class="text-lg font-semibold text-blue-800 dark:text-blue-300 mb-2">üéØ –¶–µ–ª—å –≥–ª–∞–≤—ã</h3>
                    <p class="text-blue-700 dark:text-blue-400">
                        –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º .searchable, debounce –∏ API-–ø–æ–∏—Å–∫–∞.
                    </p>
                </div>

                <h2 class="text-2xl font-bold mt-12 mb-4">–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä .searchable</h2>
                <p class="text-zinc-600 dark:text-zinc-400 mb-4">
                    SwiftUI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ –ø–æ–∏—Å–∫–∞:
                </p>

                <pre><code class="language-swift rounded-xl">struct ProductListView: View {
    @State private var viewModel = ProductViewModel()
    @State private var searchText = ""

    var body: some View {
        NavigationStack {
            List(viewModel.filteredProducts) { product in
                ProductRow(product: product)
            }
            .navigationTitle("–¢–æ–≤–∞—Ä—ã")
            .searchable(text: $searchText, prompt: "–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...")
        }
    }
}</code></pre>

                <h2 class="text-2xl font-bold mt-12 mb-4">–õ–æ–∫–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è</h2>
                <pre><code class="language-swift rounded-xl">@Observable
final class ProductViewModel {
    var products: [Product] = []
    var searchText = ""

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
    var filteredProducts: [Product] {
        guard !searchText.isEmpty else { return products }

        return products.filter { product in
            product.title.localizedCaseInsensitiveContains(searchText) ||
            product.brand.localizedCaseInsensitiveContains(searchText) ||
            product.category.localizedCaseInsensitiveContains(searchText)
        }
    }
}</code></pre>

                <h2 class="text-2xl font-bold mt-12 mb-4">API-–ø–æ–∏—Å–∫ —Å Debounce</h2>
                <p class="text-zinc-600 dark:text-zinc-400 mb-4">
                    –î–ª—è API-–ø–æ–∏—Å–∫–∞ –≤–∞–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å debounce, —á—Ç–æ–±—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª:
                </p>

                <pre><code class="language-swift rounded-xl">import Combine

@Observable
final class SearchViewModel {
    var searchText = ""
    var products: [Product] = []
    var isSearching = false

    private let service: ProductServiceProtocol
    private var searchTask: Task<Void, Never>?

    init(service: ProductServiceProtocol = ProductService()) {
        self.service = service
    }

    func search() {
        // –û—Ç–º–µ–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–ø—Ä–æ—Å
        searchTask?.cancel()

        guard !searchText.isEmpty else {
            products = []
            return
        }

        // Debounce: –∂–¥—ë–º 0.5 —Å–µ–∫—É–Ω–¥—ã
        searchTask = Task {
            try? await Task.sleep(nanoseconds: 500_000_000)

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–∞–¥–∞—á–∞ –Ω–µ –æ—Ç–º–µ–Ω–µ–Ω–∞
            guard !Task.isCancelled else { return }

            await performSearch()
        }
    }

    @MainActor
    private func performSearch() async {
        isSearching = true

        do {
            products = try await service.searchProducts(query: searchText)
        } catch {
            products = []
        }

        isSearching = false
    }
}</code></pre>

                <h2 class="text-2xl font-bold mt-12 mb-4">SearchView</h2>
                <pre><code class="language-swift rounded-xl">struct SearchView: View {
    @State private var viewModel = SearchViewModel()

    var body: some View {
        NavigationStack {
            Group {
                if viewModel.searchText.isEmpty {
                    emptyState
                } else if viewModel.isSearching {
                    ProgressView("–ü–æ–∏—Å–∫...")
                } else if viewModel.products.isEmpty {
                    noResults
                } else {
                    searchResults
                }
            }
            .navigationTitle("–ü–æ–∏—Å–∫")
            .searchable(
                text: $viewModel.searchText,
                prompt: "–ù–∞–∑–≤–∞–Ω–∏–µ, –±—Ä–µ–Ω–¥, –∫–∞—Ç–µ–≥–æ—Ä–∏—è..."
            )
            .onChange(of: viewModel.searchText) { _, _ in
                viewModel.search()
            }
        }
    }

    private var emptyState: some View {
        VStack(spacing: 16) {
            Image(systemName: "magnifyingglass")
                .font(.system(size: 60))
                .foregroundColor(.secondary)

            Text("–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞")
                .font(.headline)
                .foregroundColor(.secondary)
        }
    }

    private var noResults: some View {
        VStack(spacing: 16) {
            Image(systemName: "doc.text.magnifyingglass")
                .font(.system(size: 60))
                .foregroundColor(.secondary)

            Text("–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
                .font(.headline)

            Text("–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å")
                .font(.subheadline)
                .foregroundColor(.secondary)
        }
    }

    private var searchResults: some View {
        List(viewModel.products) { product in
            NavigationLink(value: product) {
                SearchResultRow(product: product)
            }
        }
        .navigationDestination(for: Product.self) { product in
            ProductDetailView(product: product)
        }
    }
}

struct SearchResultRow: View {
    let product: Product

    var body: some View {
        HStack(spacing: 12) {
            AsyncImage(url: URL(string: product.thumbnail)) { image in
                image.resizable().aspectRatio(contentMode: .fill)
            } placeholder: {
                Color.gray.opacity(0.2)
            }
            .frame(width: 60, height: 60)
            .cornerRadius(8)

            VStack(alignment: .leading, spacing: 4) {
                Text(product.title)
                    .font(.subheadline)
                    .fontWeight(.medium)
                    .lineLimit(2)

                Text(product.brand)
                    .font(.caption)
                    .foregroundColor(.secondary)

                Text(product.formattedPrice)
                    .font(.subheadline)
                    .fontWeight(.bold)
                    .foregroundColor(.blue)
            }
        }
    }
}</code></pre>

                <h2 class="text-2xl font-bold mt-12 mb-4">Search Suggestions</h2>
                <pre><code class="language-swift rounded-xl">.searchable(text: $searchText) {
    // –ù–µ–¥–∞–≤–Ω–∏–µ –ø–æ–∏—Å–∫–∏
    ForEach(recentSearches, id: \.self) { term in
        Label(term, systemImage: "clock")
            .searchCompletion(term)
    }

    // –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    Section("–ö–∞—Ç–µ–≥–æ—Ä–∏–∏") {
        ForEach(categories, id: \.self) { category in
            Label(category, systemImage: "tag")
                .searchCompletion(category)
        }
    }
}</code></pre>

                <h2 class="text-2xl font-bold mt-12 mb-4">üèãÔ∏è –ó–∞–¥–∞–Ω–∏—è</h2>
                <div class="bg-zinc-50 dark:bg-zinc-900 rounded-xl p-6 border border-zinc-200 dark:border-zinc-800">
                    <ol class="space-y-4 text-zinc-600 dark:text-zinc-400">
                        <li><strong>1.</strong> –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞ –≤ UserDefaults (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø—Ä–æ—Å–æ–≤)</li>
                        <li><strong>2.</strong> –î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ —Ü–µ–Ω–æ–≤–æ–º—É –¥–∏–∞–ø–∞–∑–æ–Ω—É</li>
                        <li><strong>3.</strong> –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —Ü–µ–Ω–µ, —Ä–µ–π—Ç–∏–Ω–≥—É, –Ω–∞–∑–≤–∞–Ω–∏—é)</li>
                    </ol>
                </div>

                <!-- Navigation -->
                <div class="flex justify-between items-center mt-16 pt-8 border-t border-zinc-200 dark:border-zinc-800">
                    <a href="06-product-detail.html" class="flex items-center gap-2 text-zinc-600 dark:text-zinc-400 hover:text-primary transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                        –ì–ª–∞–≤–∞ 6: –î–µ—Ç–∞–ª–∏
                    </a>
                    <a href="08-favorites.html" class="flex items-center gap-2 px-6 py-3 bg-primary text-white rounded-xl hover:bg-blue-600 transition-colors">
                        –ì–ª–∞–≤–∞ 8: –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </a>
                </div>
            </article>
        </main>
    </div>

    <script>hljs.highlightAll();</script>
</body>
</html>
