# Ğ“Ğ»Ğ°Ğ²Ğ° 16: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² â€” Home Ğ¸ ProductList

## Ğ’Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ

Ğ’ ÑÑ‚Ğ¾Ğ¹ Ğ³Ğ»Ğ°Ğ²Ğµ Ğ¼Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ´Ğ¸Ğ¼ **Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ÑĞºÑ€Ğ°Ğ½ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ** â€” Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Home, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚:
- ĞŸĞ¾Ğ¸ÑĞº Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
- ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² (Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº)
- Ğ¡ĞµÑ‚ĞºÑƒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ñ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ

Ğ­Ñ‚Ğ¾ Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ, Ñ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ³Ğ¾ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹ Ğ¿ÑƒÑ‚ÑŒ.

### Ğ§Ñ‚Ğ¾ Ğ¼Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ´Ğ¸Ğ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Home Screen                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ” Search products...                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  Categories:                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ All  â”‚ â”‚Electrâ”‚ â”‚Jewel â”‚ â”‚Men's â”‚ â†’             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚  [Image]  â”‚  â”‚  [Image]  â”‚                       â”‚
â”‚  â”‚  â™¡        â”‚  â”‚  â™¡        â”‚                       â”‚
â”‚  â”‚ Product 1 â”‚  â”‚ Product 2 â”‚                       â”‚
â”‚  â”‚  $99.99   â”‚  â”‚  $149.99  â”‚                       â”‚
â”‚  â”‚  â­ 4.5   â”‚  â”‚  â­ 4.2   â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚  [Image]  â”‚  â”‚  [Image]  â”‚                       â”‚
â”‚  â”‚  â™¡        â”‚  â”‚  â™¡        â”‚                       â”‚
â”‚  â”‚ Product 3 â”‚  â”‚ Product 4 â”‚                       â”‚
â”‚  â”‚  $29.99   â”‚  â”‚  $199.99  â”‚                       â”‚
â”‚  â”‚  â­ 4.8   â”‚  â”‚  â­ 3.9   â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 16.1 Product Entity â€” Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ´Ğ¸Ğ¼ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°. Ğ­Ñ‚Ğ¾ **struct**, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ.

```swift
// ECommerce/Entities/Models/Product.swift

import Foundation

/// ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ğ¸Ğ· FakeStore API
/// https://fakestoreapi.com/docs
///
/// ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ JSON Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:
/// {
///     "id": 1,
///     "title": "Fjallraven - Foldsack No. 1 Backpack",
///     "price": 109.95,
///     "description": "Your perfect pack...",
///     "category": "men's clothing",
///     "image": "https://fakestoreapi.com/img/81fPKd-2AYL._AC_SL1500_.jpg",
///     "rating": {
///         "rate": 3.9,
///         "count": 120
///     }
/// }
struct Product: Codable, Equatable {
    let id: Int              // Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    let title: String        // ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    let price: Double        // Ğ¦ĞµĞ½Ğ° Ğ² Ğ´Ğ¾Ğ»Ğ»Ğ°Ñ€Ğ°Ñ…
    let description: String  // ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    let category: String     // ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ (electronics, jewelery, men's clothing, women's clothing)
    let image: String        // URL Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    let rating: Rating       // Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ Ğ¸ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ²

    /// Ğ’Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ğ°
    struct Rating: Codable, Equatable {
        let rate: Double     // Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ (0.0 - 5.0)
        let count: Int       // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ²
    }
}

// MARK: - Computed Properties

extension Product {
    /// Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ñ†ĞµĞ½Ğ° Ñ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ¼ Ğ´Ğ¾Ğ»Ğ»Ğ°Ñ€Ğ°
    /// ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: "$109.95"
    var formattedPrice: String {
        return String(format: "$%.2f", price)
    }

    /// Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ ÑĞ¾ Ğ·Ğ²ĞµĞ·Ğ´Ğ¾Ğ¹
    /// ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: "â­ 3.9 (120)"
    var formattedRating: String {
        return String(format: "â­ %.1f (%d)", rating.rate, rating.count)
    }

    /// ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ Ñ Ğ·Ğ°Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¹ Ğ±ÑƒĞºĞ²Ñ‹
    /// ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: "Men's Clothing"
    var formattedCategory: String {
        return category.capitalized
    }
}
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ struct, Ğ° Ğ½Ğµ class?**
- Product â€” ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· API)
- ĞĞ°Ğ¼ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ½Ğ°ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
- ĞĞ°Ğ¼ Ğ½ÑƒĞ¶Ğ½Ğ° Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ ĞºĞ¾Ğ¿Ğ¸Ğ¹ (value type)
- Codable Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ¾ struct

---

## 16.2 Products Service â€” Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ API

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ´Ğ¸Ğ¼ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ¸Ğ· FakeStore API.

```swift
// ECommerce/Services/ProductsService.swift

import Foundation

// MARK: - Protocol

/// ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ» ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
/// ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ API Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
protocol ProductsServiceProtocol {
    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ²ÑĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹
    func getProducts(completion: @escaping (Result<[Product], NetworkError>) -> Void)

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    func getProductsByCategory(
        _ category: String,
        completion: @escaping (Result<[Product], NetworkError>) -> Void
    )

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹
    func getCategories(completion: @escaping (Result<[String], NetworkError>) -> Void)

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ¾Ğ´Ğ¸Ğ½ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¿Ğ¾ ID
    func getProduct(
        by id: Int,
        completion: @escaping (Result<Product, NetworkError>) -> Void
    )
}

// MARK: - Implementation

/// Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
/// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ FakeStore API: https://fakestoreapi.com
final class ProductsService: ProductsServiceProtocol {

    // MARK: - Properties

    /// Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¾Ñ‚ NetworkManager (Dependency Injection)
    private let networkManager: NetworkManagerProtocol

    // MARK: - Init

    /// Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€ Ñ Ğ²Ğ½ĞµĞ´Ñ€ĞµĞ½Ğ¸ĞµĞ¼ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
    /// - Parameter networkManager: ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ÑĞµÑ‚Ğ¸ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ shared)
    init(networkManager: NetworkManagerProtocol = NetworkManager.shared) {
        self.networkManager = networkManager
    }

    // MARK: - Products

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ²ÑĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹
    /// Endpoint: GET /products
    func getProducts(completion: @escaping (Result<[Product], NetworkError>) -> Void) {
        // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ endpoint Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ²ÑĞµÑ… Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
        let endpoint = ProductsEndpoint.products

        // Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ‡ĞµÑ€ĞµĞ· NetworkManager
        networkManager.request(
            type: [Product].self,  // ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼ Ğ¼Ğ°ÑÑĞ¸Ğ² Product
            url: endpoint.url,
            method: endpoint.method
        ) { result in
            // ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‘Ğ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ² completion
            // NetworkManager ÑƒĞ¶Ğµ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ completion Ğ½Ğ° main queue
            completion(result)
        }
    }

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    /// Endpoint: GET /products/category/{category}
    func getProductsByCategory(
        _ category: String,
        completion: @escaping (Result<[Product], NetworkError>) -> Void
    ) {
        let endpoint = ProductsEndpoint.productsByCategory(category)

        networkManager.request(
            type: [Product].self,
            url: endpoint.url,
            method: endpoint.method,
            completion: completion
        )
    }

    // MARK: - Categories

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹
    /// Endpoint: GET /products/categories
    /// Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚: ["electronics", "jewelery", "men's clothing", "women's clothing"]
    func getCategories(completion: @escaping (Result<[String], NetworkError>) -> Void) {
        let endpoint = ProductsEndpoint.categories

        networkManager.request(
            type: [String].self,  // API Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¼Ğ°ÑÑĞ¸Ğ² ÑÑ‚Ñ€Ğ¾Ğº
            url: endpoint.url,
            method: endpoint.method,
            completion: completion
        )
    }

    // MARK: - Single Product

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ¾Ğ´Ğ¸Ğ½ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¿Ğ¾ ID
    /// Endpoint: GET /products/{id}
    func getProduct(
        by id: Int,
        completion: @escaping (Result<Product, NetworkError>) -> Void
    ) {
        let endpoint = ProductsEndpoint.product(id)

        networkManager.request(
            type: Product.self,  // ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼ Ğ¾Ğ´Ğ¸Ğ½ Product
            url: endpoint.url,
            method: endpoint.method,
            completion: completion
        )
    }
}
```

### Products Endpoint â€” Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ URL

```swift
// ECommerce/Services/ProductsEndpoint.swift

import Foundation

/// Endpoints Ğ´Ğ»Ñ FakeStore API
/// Base URL: https://fakestoreapi.com
enum ProductsEndpoint: EndpointProtocol {

    /// GET /products â€” Ğ²ÑĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹
    case products

    /// GET /products/{id} â€” Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¿Ğ¾ ID
    case product(Int)

    /// GET /products/categories â€” ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹
    case categories

    /// GET /products/category/{name} â€” Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    case productsByCategory(String)

    // MARK: - EndpointProtocol

    /// Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ URL API
    var baseURL: String {
        return "https://fakestoreapi.com"
    }

    /// ĞŸÑƒÑ‚ÑŒ Ğº endpoint
    var path: String {
        switch self {
        case .products:
            return "/products"
        case .product(let id):
            return "/products/\(id)"
        case .categories:
            return "/products/categories"
        case .productsByCategory(let category):
            // URL encode Ğ´Ğ»Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹ Ñ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°Ğ¼Ğ¸ ("men's clothing")
            let encodedCategory = category.addingPercentEncoding(
                withAllowedCharacters: .urlPathAllowed
            ) ?? category
            return "/products/category/\(encodedCategory)"
        }
    }

    /// HTTP Ğ¼ĞµÑ‚Ğ¾Ğ´
    var method: HTTPMethods {
        return .get  // Ğ’ÑĞµ endpoints Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ GET
    }

    /// ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ URL
    var url: String {
        return baseURL + path
    }
}
```

---

## 16.3 Home Module â€” VIPER Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

Ğ¢ĞµĞ¿ĞµÑ€ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ´Ğ¸Ğ¼ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ VIPER Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ»Ñ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ ÑĞºÑ€Ğ°Ğ½Ğ°.

### VIPER Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Home Module

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          HOME MODULE                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚ creates â”‚                  â”‚
â”‚  HomeRouter      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ HomeViewControllerâ”‚
â”‚                  â”‚         â”‚     (View)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚ navigates                  â”‚ user actions
         â”‚                            â”‚
         â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
â”‚  Detail/Basket   â”‚ presentsâ”‚  HomePresenter   â”‚
â”‚                  â”‚         â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                             data     â”‚ business logic
                             binding  â”‚
                                      â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚                  â”‚
                             â”‚  HomeInteractor  â”‚
                             â”‚                  â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ API calls
                                      â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚                  â”‚
                             â”‚ ProductsService  â”‚
                             â”‚                  â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 16.3.1 Protocols â€” ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ

```swift
// ECommerce/Modules/Home/HomeProtocols.swift

import UIKit

// MARK: - View Protocol

/// ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ» View Ğ´Ğ»Ñ Home Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
/// View Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ·Ğ° Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
/// Presenter Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ View Ğ§Ğ¢Ğ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ
protocol HomeViewProtocol: AnyObject {
    /// Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Presenter
    var presenter: HomePresenterProtocol? { get set }

    /// ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ
    func showLoading()

    /// Ğ¡ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ
    func hideLoading()

    /// ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ² ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸
    /// - Parameter products: ĞœĞ°ÑÑĞ¸Ğ² Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
    func showProducts(_ products: [Product])

    /// ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    /// - Parameter categories: ĞœĞ°ÑÑĞ¸Ğ² ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹ (Ğ¿ĞµÑ€Ğ²Ğ°Ñ â€” "All")
    func showCategories(_ categories: [String])

    /// ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
    /// - Parameter error: ĞĞ±ÑŠĞµĞºÑ‚ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
    func showError(_ error: Error)

    /// ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸
    func reloadData()
}

// MARK: - Presenter Protocol

/// ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ» Presenter Ğ´Ğ»Ñ Home Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
/// Presenter â€” ÑĞ²ÑĞ·ÑƒÑÑ‰ĞµĞµ Ğ·Ğ²ĞµĞ½Ğ¾ Ğ¼ĞµĞ¶Ğ´Ñƒ View Ğ¸ Interactor
/// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ¾Ñ‚ View, Ğ·Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñƒ Interactor
protocol HomePresenterProtocol: AnyObject {
    /// Ğ¡ÑÑ‹Ğ»ĞºĞ¸ Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ VIPER
    var view: HomeViewProtocol? { get set }
    var interactor: HomeInteractorProtocol? { get set }
    var router: HomeRouterProtocol? { get set }

    /// View Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ğ»ÑÑ â€” Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµĞ¼ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    func viewDidLoad()

    /// View Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑÑ Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½Ğµ
    func viewWillAppear()

    /// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
    func numberOfProducts() -> Int

    /// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¿Ğ¾ Ğ¸Ğ½Ğ´ĞµĞºÑÑƒ
    func product(at index: Int) -> Product?

    /// ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» Ñ‚Ğ¾Ğ²Ğ°Ñ€ â€” Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ½Ğ° Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸
    func didSelectProduct(at index: Int)

    /// ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ°Ğ» Ğ½Ğ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ
    func didTapFavorite(at index: Int)

    /// ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ
    func didSelectCategory(_ category: String)

    /// ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ²Ñ‘Ğ» Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
    func didSearch(with query: String)

    /// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ğµ (Ğ´Ğ»Ñ badge)
    func getBasketCount() -> Int
}

// MARK: - Interactor Protocol

/// ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ» Interactor Ğ´Ğ»Ñ Home Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
/// Interactor ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ
/// Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸, Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
protocol HomeInteractorProtocol: AnyObject {
    /// Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° output (Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Presenter)
    var output: HomeInteractorOutputProtocol? { get set }

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹
    func fetchProducts()

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    func fetchProductsByCategory(_ category: String)

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹
    func fetchCategories()

    /// Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ/ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
    func toggleFavorite(product: Product)

    /// ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼ Ğ»Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€
    func isFavorite(productId: Int) -> Bool

    /// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ğµ
    func getBasketCount() -> Int
}

// MARK: - Interactor Output Protocol

/// ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ» Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· Interactor Ğ² Presenter
/// Interactor Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ÑÑ‚Ğ¸ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ ĞºĞ¾Ğ³Ğ´Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹
protocol HomeInteractorOutputProtocol: AnyObject {
    /// Ğ¢Ğ¾Ğ²Ğ°Ñ€Ñ‹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹
    func didFetchProducts(_ products: [Product])

    /// ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
    func didFailFetchProducts(_ error: Error)

    /// ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹
    func didFetchCategories(_ categories: [String])

    /// ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹
    func didFailFetchCategories(_ error: Error)
}

// MARK: - Router Protocol

/// ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ» Router Ğ´Ğ»Ñ Home Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
/// Router Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ·Ğ° Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ
protocol HomeRouterProtocol: AnyObject {
    /// Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Home
    static func createModule() -> UIViewController

    /// ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    func navigateToProductDetail(from view: HomeViewProtocol?, product: Product)

    /// ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ
    func navigateToBasket(from view: HomeViewProtocol?)
}
```

### 16.3.2 Router â€” ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ¸ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ

```swift
// ECommerce/Modules/Home/HomeRouter.swift

import UIKit

/// Router Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Home
/// ĞÑ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ·Ğ°:
/// 1. Ğ¡Ğ±Ğ¾Ñ€ĞºÑƒ VIPER Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ (dependency injection)
/// 2. ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ÑĞºÑ€Ğ°Ğ½Ñ‹
final class HomeRouter: HomeRouterProtocol {

    // MARK: - Properties

    /// Ğ¡Ğ»Ğ°Ğ±Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ViewController Ğ´Ğ»Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸
    weak var viewController: UIViewController?

    // MARK: - Module Creation

    /// Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ¸ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ VIPER Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Home
    /// Ğ­Ñ‚Ğ¾ Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
    ///
    /// ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½: Factory Method + Dependency Injection
    ///
    /// - Returns: Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğ¹ UIViewController Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¼ VIPER
    static func createModule() -> UIViewController {
        // 1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ View
        let view = HomeViewController()

        // 2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
        let presenter = HomePresenter()
        let interactor = HomeInteractor()
        let router = HomeRouter()

        // 3. Ğ¡Ğ²ÑĞ·Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ (Dependency Injection)
        view.presenter = presenter

        presenter.view = view
        presenter.interactor = interactor
        presenter.router = router

        interactor.output = presenter

        router.viewController = view

        // 4. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğ¹ View
        return view
    }

    // MARK: - Navigation

    /// ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    /// - Parameters:
    ///   - view: Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ View (Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ navigation controller)
    ///   - product: Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
    func navigateToProductDetail(from view: HomeViewProtocol?, product: Product) {
        // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
        let detailVC = ProductDetailRouter.createModule(with: product)

        // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ navigation controller Ğ¸ Ğ´ĞµĞ»Ğ°ĞµĞ¼ push
        if let sourceView = view as? UIViewController {
            sourceView.navigationController?.pushViewController(detailVC, animated: true)
        }
    }

    /// ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ
    func navigateToBasket(from view: HomeViewProtocol?) {
        let basketVC = BasketRouter.createModule()

        if let sourceView = view as? UIViewController {
            sourceView.navigationController?.pushViewController(basketVC, animated: true)
        }
    }
}
```

### 16.3.3 Interactor â€” Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°

```swift
// ECommerce/Modules/Home/HomeInteractor.swift

import Foundation

/// Interactor Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Home
/// Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ²ÑÑ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ:
/// - Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ¸Ğ· API
/// - Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¼ (Realm)
/// - Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ¿Ğ¾Ğ¸ÑĞº
final class HomeInteractor: HomeInteractorProtocol {

    // MARK: - Properties

    /// Output Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Presenter
    weak var output: HomeInteractorOutputProtocol?

    /// Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ API Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
    private let productsService: ProductsServiceProtocol

    /// ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Realm (Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ)
    private let realmManager: RealmManagerProtocol

    /// ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹
    private let basketManager: BasketManagerProtocol

    /// ĞšÑÑˆ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ñ… Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² (Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¸ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸)
    private var cachedProducts: [Product] = []

    // MARK: - Init

    /// Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€ Ñ Ğ²Ğ½ĞµĞ´Ñ€ĞµĞ½Ğ¸ĞµĞ¼ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
    /// - Parameters:
    ///   - productsService: Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ ProductsService)
    ///   - realmManager: ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Realm (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ shared)
    ///   - basketManager: ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ shared)
    init(
        productsService: ProductsServiceProtocol = ProductsService(),
        realmManager: RealmManagerProtocol = RealmManager.shared,
        basketManager: BasketManagerProtocol = BasketManager.shared
    ) {
        self.productsService = productsService
        self.realmManager = realmManager
        self.basketManager = basketManager
    }

    // MARK: - Fetch Products

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ²ÑĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ¸Ğ· API
    func fetchProducts() {
        productsService.getProducts { [weak self] result in
            guard let self = self else { return }

            switch result {
            case .success(let products):
                // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² ĞºÑÑˆ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
                self.cachedProducts = products
                // ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‘Ğ¼ Ğ² Presenter
                self.output?.didFetchProducts(products)

            case .failure(let error):
                self.output?.didFailFetchProducts(error)
            }
        }
    }

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    /// - Parameter category: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    func fetchProductsByCategory(_ category: String) {
        // Ğ•ÑĞ»Ğ¸ "All" â€” Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ²ÑĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹
        if category.lowercased() == "all" {
            fetchProducts()
            return
        }

        productsService.getProductsByCategory(category) { [weak self] result in
            guard let self = self else { return }

            switch result {
            case .success(let products):
                self.cachedProducts = products
                self.output?.didFetchProducts(products)

            case .failure(let error):
                self.output?.didFailFetchProducts(error)
            }
        }
    }

    // MARK: - Fetch Categories

    /// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹ Ğ¸Ğ· API
    func fetchCategories() {
        productsService.getCategories { [weak self] result in
            guard let self = self else { return }

            switch result {
            case .success(var categories):
                // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ "All" Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ÑĞ¿Ğ¸ÑĞºĞ°
                categories.insert("all", at: 0)
                // Ğ”ĞµĞ»Ğ°ĞµĞ¼ Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ±ÑƒĞºĞ²Ñƒ Ğ·Ğ°Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¹
                let formattedCategories = categories.map { $0.capitalized }
                self.output?.didFetchCategories(formattedCategories)

            case .failure(let error):
                self.output?.didFailFetchCategories(error)
            }
        }
    }

    // MARK: - Favorites

    /// Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¸Ğ»Ğ¸ ÑƒĞ´Ğ°Ğ»ÑĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
    /// - Parameter product: Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ»Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ/ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ
    func toggleFavorite(product: Product) {
        // ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Product Ğ² FavoriteProduct (Realm object)
        let favoriteProduct = FavoriteProduct(from: product)

        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼
        if isFavorite(productId: product.id) {
            // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
            realmManager.delete(favoriteProduct) { result in
                switch result {
                case .success:
                    print("âœ… Removed from favorites: \(product.title)")
                case .failure(let error):
                    print("âŒ Failed to remove from favorites: \(error)")
                }
            }
        } else {
            // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ
            realmManager.add(favoriteProduct) { result in
                switch result {
                case .success:
                    print("âœ… Added to favorites: \(product.title)")
                case .failure(let error):
                    print("âŒ Failed to add to favorites: \(error)")
                }
            }
        }
    }

    /// ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ğ»Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼
    /// - Parameter productId: ID Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    /// - Returns: true ĞµÑĞ»Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼
    func isFavorite(productId: Int) -> Bool {
        let favorites: [FavoriteProduct] = realmManager.fetch()
        return favorites.contains { $0.id == productId }
    }

    // MARK: - Basket

    /// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ğµ
    /// - Returns: ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹ Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ğµ
    func getBasketCount() -> Int {
        return basketManager.getBasketItems().count
    }
}
```

### 16.3.4 Presenter â€” ÑĞ²ÑĞ·ÑƒÑÑ‰ĞµĞµ Ğ·Ğ²ĞµĞ½Ğ¾

```swift
// ECommerce/Modules/Home/HomePresenter.swift

import Foundation

/// Presenter Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Home
/// Ğ¡Ğ²ÑĞ·Ñ‹Ğ²Ğ°ĞµÑ‚ View Ğ¸ Interactor
/// ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
/// Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
final class HomePresenter: HomePresenterProtocol {

    // MARK: - VIPER References

    /// Ğ¡Ğ»Ğ°Ğ±Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° View (Ğ¸Ğ·Ğ±ĞµĞ³Ğ°ĞµĞ¼ retain cycle)
    weak var view: HomeViewProtocol?

    /// Ğ¡Ğ¸Ğ»ÑŒĞ½Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Interactor (Presenter Ğ²Ğ»Ğ°Ğ´ĞµĞµÑ‚ Interactor)
    var interactor: HomeInteractorProtocol?

    /// Ğ¡Ğ¸Ğ»ÑŒĞ½Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Router
    var router: HomeRouterProtocol?

    // MARK: - Properties

    /// Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼Ñ‹Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹
    private var products: [Product] = []

    /// Ğ’ÑĞµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ (Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ°)
    private var allProducts: [Product] = []

    /// Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ°Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ
    private var selectedCategory: String = "All"

    /// Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
    private var currentSearchQuery: String = ""

    // MARK: - Lifecycle

    /// Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ ĞºĞ¾Ğ³Ğ´Ğ° View Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½
    /// ĞĞ°Ñ‡Ğ¸Ğ½Ğ°ĞµĞ¼ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    func viewDidLoad() {
        // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
        view?.showLoading()

        // Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾
        interactor?.fetchCategories()
        interactor?.fetchProducts()
    }

    /// Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ ĞºĞ¾Ğ³Ğ´Ğ° View Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑÑ Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½Ğµ
    /// ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, badge ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹)
    func viewWillAppear() {
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ View (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ³Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒÑÑ)
        view?.reloadData()
    }

    // MARK: - Data Source

    /// Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
    func numberOfProducts() -> Int {
        return products.count
    }

    /// Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¿Ğ¾ Ğ¸Ğ½Ğ´ĞµĞºÑÑƒ
    /// - Parameter index: Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ² Ğ¼Ğ°ÑÑĞ¸Ğ²Ğµ
    /// - Returns: Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ¸Ğ»Ğ¸ nil
    func product(at index: Int) -> Product? {
        guard index >= 0 && index < products.count else { return nil }
        return products[index]
    }

    // MARK: - User Actions

    /// ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» Ñ‚Ğ¾Ğ²Ğ°Ñ€
    /// - Parameter index: Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    func didSelectProduct(at index: Int) {
        guard let product = product(at: index) else { return }
        // ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹
        router?.navigateToProductDetail(from: view, product: product)
    }

    /// ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ°Ğ» Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
    /// - Parameter index: Ğ˜Ğ½Ğ´ĞµĞºÑ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    func didTapFavorite(at index: Int) {
        guard let product = product(at: index) else { return }
        // ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
        interactor?.toggleFavorite(product: product)
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ UI
        view?.reloadData()
    }

    /// ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ
    /// - Parameter category: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    func didSelectCategory(_ category: String) {
        selectedCategory = category
        view?.showLoading()

        if category.lowercased() == "all" {
            // Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ»Ğ¸ "All" â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²ÑĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹
            interactor?.fetchProducts()
        } else {
            // Ğ˜Ğ½Ğ°Ñ‡Ğµ â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
            interactor?.fetchProductsByCategory(category.lowercased())
        }
    }

    /// ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ²Ñ‘Ğ» Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
    /// - Parameter query: Ğ¢ĞµĞºÑÑ‚ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
    func didSearch(with query: String) {
        currentSearchQuery = query

        if query.isEmpty {
            // Ğ•ÑĞ»Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²ÑĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
            products = allProducts
        } else {
            // Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ (case-insensitive)
            products = allProducts.filter { product in
                product.title.lowercased().contains(query.lowercased())
            }
        }

        view?.showProducts(products)
    }

    /// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ğµ
    func getBasketCount() -> Int {
        return interactor?.getBasketCount() ?? 0
    }
}

// MARK: - InteractorOutput

extension HomePresenter: HomeInteractorOutputProtocol {

    /// Ğ¢Ğ¾Ğ²Ğ°Ñ€Ñ‹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹
    func didFetchProducts(_ products: [Product]) {
        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ²ÑĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
        self.allProducts = products

        // ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
        if currentSearchQuery.isEmpty {
            self.products = products
        } else {
            self.products = products.filter { product in
                product.title.lowercased().contains(currentSearchQuery.lowercased())
            }
        }

        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ View
        view?.hideLoading()
        view?.showProducts(self.products)
    }

    /// ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
    func didFailFetchProducts(_ error: Error) {
        view?.hideLoading()
        view?.showError(error)
    }

    /// ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹
    func didFetchCategories(_ categories: [String]) {
        view?.showCategories(categories)
    }

    /// ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹
    func didFailFetchCategories(_ error: Error) {
        // Ğ•ÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ "All"
        view?.showCategories(["All"])
    }
}
```

### 16.3.5 View â€” HomeViewController

```swift
// ECommerce/Modules/Home/HomeViewController.swift

import UIKit
import SnapKit

/// ViewController Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ ÑĞºÑ€Ğ°Ğ½Ğ°
/// ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚:
/// - Search bar Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
/// - Ğ“Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹
/// - Ğ¡ĞµÑ‚ĞºÑƒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² (2 ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸)
final class HomeViewController: UIViewController {

    // MARK: - VIPER

    var presenter: HomePresenterProtocol?

    // MARK: - UI Elements

    /// ĞŸĞ¾Ğ»Ğµ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
    private let searchBar: UISearchBar = {
        let searchBar = UISearchBar()
        searchBar.placeholder = "Search products..."
        searchBar.searchBarStyle = .minimal
        searchBar.backgroundColor = .clear
        return searchBar
    }()

    /// ĞšĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹ (Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ)
    private lazy var categoriesCollectionView: UICollectionView = {
        let layout = UICollectionViewFlowLayout()
        layout.scrollDirection = .horizontal
        layout.estimatedItemSize = UICollectionViewFlowLayout.automaticSize
        layout.minimumInteritemSpacing = 8
        layout.sectionInset = UIEdgeInsets(top: 0, left: 16, bottom: 0, right: 16)

        let cv = UICollectionView(frame: .zero, collectionViewLayout: layout)
        cv.backgroundColor = .clear
        cv.showsHorizontalScrollIndicator = false
        cv.delegate = self
        cv.dataSource = self
        cv.register(CategoryCell.self, forCellWithReuseIdentifier: CategoryCell.identifier)
        return cv
    }()

    /// ĞšĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² (ÑĞµÑ‚ĞºĞ° 2 ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸)
    private lazy var productsCollectionView: UICollectionView = {
        let layout = UICollectionViewFlowLayout()
        layout.scrollDirection = .vertical
        layout.minimumLineSpacing = 16
        layout.minimumInteritemSpacing = 16
        layout.sectionInset = UIEdgeInsets(top: 16, left: 16, bottom: 16, right: 16)

        let cv = UICollectionView(frame: .zero, collectionViewLayout: layout)
        cv.backgroundColor = .clear
        cv.showsVerticalScrollIndicator = true
        cv.delegate = self
        cv.dataSource = self
        cv.register(ProductCell.self, forCellWithReuseIdentifier: ProductCell.identifier)
        return cv
    }()

    /// Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
    private let activityIndicator: UIActivityIndicatorView = {
        let indicator = UIActivityIndicatorView(style: .large)
        indicator.hidesWhenStopped = true
        return indicator
    }()

    // MARK: - Data

    /// ĞœĞ°ÑÑĞ¸Ğ² ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
    private var categories: [String] = []

    /// Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¹ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    private var selectedCategoryIndex: Int = 0

    /// ĞœĞ°ÑÑĞ¸Ğ² Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
    private var products: [Product] = []

    // MARK: - Lifecycle

    override func viewDidLoad() {
        super.viewDidLoad()
        setupUI()
        setupDelegates()
        presenter?.viewDidLoad()
    }

    override func viewWillAppear(_ animated: Bool) {
        super.viewWillAppear(animated)
        presenter?.viewWillAppear()
        updateBasketBadge()
    }

    // MARK: - Setup UI

    private func setupUI() {
        view.backgroundColor = .systemBackground
        title = "Shop"

        // Navigation bar
        navigationController?.navigationBar.prefersLargeTitles = true

        // ĞšĞ½Ğ¾Ğ¿ĞºĞ° ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹ Ğ² Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸
        let basketButton = UIBarButtonItem(
            image: UIImage(systemName: "cart"),
            style: .plain,
            target: self,
            action: #selector(basketButtonTapped)
        )
        navigationItem.rightBarButtonItem = basketButton

        // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ subviews
        view.addSubview(searchBar)
        view.addSubview(categoriesCollectionView)
        view.addSubview(productsCollectionView)
        view.addSubview(activityIndicator)

        // Layout
        searchBar.snp.makeConstraints { make in
            make.top.equalTo(view.safeAreaLayoutGuide).offset(8)
            make.leading.trailing.equalToSuperview().inset(8)
            make.height.equalTo(44)
        }

        categoriesCollectionView.snp.makeConstraints { make in
            make.top.equalTo(searchBar.snp.bottom).offset(8)
            make.leading.trailing.equalToSuperview()
            make.height.equalTo(44)
        }

        productsCollectionView.snp.makeConstraints { make in
            make.top.equalTo(categoriesCollectionView.snp.bottom).offset(8)
            make.leading.trailing.bottom.equalToSuperview()
        }

        activityIndicator.snp.makeConstraints { make in
            make.center.equalToSuperview()
        }
    }

    private func setupDelegates() {
        searchBar.delegate = self
    }

    // MARK: - Actions

    @objc private func basketButtonTapped() {
        // ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ Ñ‡ĞµÑ€ĞµĞ· Router
        if let router = presenter?.router as? HomeRouter {
            router.navigateToBasket(from: self)
        }
    }

    /// ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ badge Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞµ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹
    private func updateBasketBadge() {
        let count = presenter?.getBasketCount() ?? 0
        if count > 0 {
            navigationItem.rightBarButtonItem?.setBadge(text: "\(count)")
        } else {
            navigationItem.rightBarButtonItem?.setBadge(text: nil)
        }
    }
}

// MARK: - HomeViewProtocol

extension HomeViewController: HomeViewProtocol {

    func showLoading() {
        activityIndicator.startAnimating()
    }

    func hideLoading() {
        activityIndicator.stopAnimating()
    }

    func showProducts(_ products: [Product]) {
        self.products = products
        productsCollectionView.reloadData()
    }

    func showCategories(_ categories: [String]) {
        self.categories = categories
        categoriesCollectionView.reloadData()
    }

    func showError(_ error: Error) {
        let alert = UIAlertController(
            title: "Error",
            message: error.localizedDescription,
            preferredStyle: .alert
        )
        alert.addAction(UIAlertAction(title: "OK", style: .default))
        present(alert, animated: true)
    }

    func reloadData() {
        productsCollectionView.reloadData()
        updateBasketBadge()
    }
}

// MARK: - UISearchBarDelegate

extension HomeViewController: UISearchBarDelegate {

    func searchBar(_ searchBar: UISearchBar, textDidChange searchText: String) {
        presenter?.didSearch(with: searchText)
    }

    func searchBarSearchButtonClicked(_ searchBar: UISearchBar) {
        searchBar.resignFirstResponder()
    }
}

// MARK: - UICollectionViewDataSource

extension HomeViewController: UICollectionViewDataSource {

    func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -> Int {
        if collectionView == categoriesCollectionView {
            return categories.count
        } else {
            return products.count
        }
    }

    func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -> UICollectionViewCell {
        if collectionView == categoriesCollectionView {
            let cell = collectionView.dequeueReusableCell(
                withReuseIdentifier: CategoryCell.identifier,
                for: indexPath
            ) as! CategoryCell

            let isSelected = indexPath.item == selectedCategoryIndex
            cell.configure(with: categories[indexPath.item], isSelected: isSelected)
            return cell
        } else {
            let cell = collectionView.dequeueReusableCell(
                withReuseIdentifier: ProductCell.identifier,
                for: indexPath
            ) as! ProductCell

            let product = products[indexPath.item]
            let isFavorite = presenter?.interactor?.isFavorite(productId: product.id) ?? false
            cell.configure(with: product, isFavorite: isFavorite)
            cell.onFavoriteTapped = { [weak self] in
                self?.presenter?.didTapFavorite(at: indexPath.item)
            }
            return cell
        }
    }
}

// MARK: - UICollectionViewDelegate

extension HomeViewController: UICollectionViewDelegate {

    func collectionView(_ collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath) {
        if collectionView == categoriesCollectionView {
            selectedCategoryIndex = indexPath.item
            categoriesCollectionView.reloadData()
            presenter?.didSelectCategory(categories[indexPath.item])
        } else {
            presenter?.didSelectProduct(at: indexPath.item)
        }
    }
}

// MARK: - UICollectionViewDelegateFlowLayout

extension HomeViewController: UICollectionViewDelegateFlowLayout {

    func collectionView(
        _ collectionView: UICollectionView,
        layout collectionViewLayout: UICollectionViewLayout,
        sizeForItemAt indexPath: IndexPath
    ) -> CGSize {
        if collectionView == productsCollectionView {
            // Ğ Ğ°Ğ·Ğ¼ĞµÑ€ ÑÑ‡ĞµĞ¹ĞºĞ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°: 2 ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸ Ñ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ°Ğ¼Ğ¸
            let padding: CGFloat = 16
            let spacing: CGFloat = 16
            let availableWidth = collectionView.bounds.width - (padding * 2) - spacing
            let itemWidth = availableWidth / 2
            let itemHeight = itemWidth * 1.5  // Ğ¡Ğ¾Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½
            return CGSize(width: itemWidth, height: itemHeight)
        }
        // Ğ”Ğ»Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹ â€” Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€
        return CGSize(width: 100, height: 36)
    }
}
```

---

## 16.4 Ğ¯Ñ‡ĞµĞ¹ĞºĞ¸ â€” ProductCell Ğ¸ CategoryCell

### ProductCell â€” ÑÑ‡ĞµĞ¹ĞºĞ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°

```swift
// ECommerce/Modules/Home/Cells/ProductCell.swift

import UIKit
import SnapKit
import SDWebImage

/// Ğ¯Ñ‡ĞµĞ¹ĞºĞ° Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ğ² ÑĞµÑ‚ĞºĞµ
final class ProductCell: UICollectionViewCell {

    // MARK: - Static

    static let identifier = "ProductCell"

    // MARK: - Callback

    /// Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ¸Ğ¸ Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
    var onFavoriteTapped: (() -> Void)?

    // MARK: - UI Elements

    /// Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    private let productImageView: UIImageView = {
        let iv = UIImageView()
        iv.contentMode = .scaleAspectFit
        iv.clipsToBounds = true
        iv.backgroundColor = .systemGray6
        return iv
    }()

    /// ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ
    private let favoriteButton: UIButton = {
        let button = UIButton(type: .system)
        button.setImage(UIImage(systemName: "heart"), for: .normal)
        button.tintColor = .systemGray
        return button
    }()

    /// ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    private let titleLabel: UILabel = {
        let label = UILabel()
        label.font = .systemFont(ofSize: 14, weight: .medium)
        label.textColor = .label
        label.numberOfLines = 2
        return label
    }()

    /// Ğ¦ĞµĞ½Ğ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    private let priceLabel: UILabel = {
        let label = UILabel()
        label.font = .systemFont(ofSize: 16, weight: .bold)
        label.textColor = .systemBlue
        return label
    }()

    /// Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    private let ratingLabel: UILabel = {
        let label = UILabel()
        label.font = .systemFont(ofSize: 12)
        label.textColor = .secondaryLabel
        return label
    }()

    // MARK: - Init

    override init(frame: CGRect) {
        super.init(frame: frame)
        setupUI()
        setupActions()
    }

    required init?(coder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }

    // MARK: - Setup

    private func setupUI() {
        // Ğ¡Ñ‚Ğ¸Ğ»ÑŒ ÑÑ‡ĞµĞ¹ĞºĞ¸
        contentView.backgroundColor = .systemBackground
        contentView.layer.cornerRadius = 12
        contentView.layer.shadowColor = UIColor.black.cgColor
        contentView.layer.shadowOpacity = 0.1
        contentView.layer.shadowOffset = CGSize(width: 0, height: 2)
        contentView.layer.shadowRadius = 4

        // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ subviews
        contentView.addSubview(productImageView)
        contentView.addSubview(favoriteButton)
        contentView.addSubview(titleLabel)
        contentView.addSubview(priceLabel)
        contentView.addSubview(ratingLabel)

        // Layout
        productImageView.snp.makeConstraints { make in
            make.top.leading.trailing.equalToSuperview().inset(8)
            make.height.equalTo(contentView.snp.width).multipliedBy(0.6)
        }

        favoriteButton.snp.makeConstraints { make in
            make.top.trailing.equalToSuperview().inset(8)
            make.size.equalTo(32)
        }

        titleLabel.snp.makeConstraints { make in
            make.top.equalTo(productImageView.snp.bottom).offset(8)
            make.leading.trailing.equalToSuperview().inset(8)
        }

        priceLabel.snp.makeConstraints { make in
            make.top.equalTo(titleLabel.snp.bottom).offset(4)
            make.leading.equalToSuperview().inset(8)
        }

        ratingLabel.snp.makeConstraints { make in
            make.top.equalTo(priceLabel.snp.bottom).offset(4)
            make.leading.equalToSuperview().inset(8)
            make.bottom.lessThanOrEqualToSuperview().inset(8)
        }
    }

    private func setupActions() {
        favoriteButton.addTarget(self, action: #selector(favoriteButtonTapped), for: .touchUpInside)
    }

    // MARK: - Actions

    @objc private func favoriteButtonTapped() {
        onFavoriteTapped?()
    }

    // MARK: - Configure

    /// ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ ÑÑ‡ĞµĞ¹ĞºÑƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    /// - Parameters:
    ///   - product: Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
    ///   - isFavorite: ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ğ»Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼
    func configure(with product: Product, isFavorite: Bool) {
        titleLabel.text = product.title
        priceLabel.text = product.formattedPrice
        ratingLabel.text = product.formattedRating

        // Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ SDWebImage
        if let url = URL(string: product.image) {
            productImageView.sd_setImage(
                with: url,
                placeholderImage: UIImage(systemName: "photo")
            )
        }

        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
        let heartImage = isFavorite ? "heart.fill" : "heart"
        let heartColor: UIColor = isFavorite ? .systemRed : .systemGray
        favoriteButton.setImage(UIImage(systemName: heartImage), for: .normal)
        favoriteButton.tintColor = heartColor
    }

    // MARK: - Reuse

    override func prepareForReuse() {
        super.prepareForReuse()
        productImageView.image = nil
        titleLabel.text = nil
        priceLabel.text = nil
        ratingLabel.text = nil
        favoriteButton.setImage(UIImage(systemName: "heart"), for: .normal)
        favoriteButton.tintColor = .systemGray
        onFavoriteTapped = nil
    }
}
```

### CategoryCell â€” ÑÑ‡ĞµĞ¹ĞºĞ° ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸

```swift
// ECommerce/Modules/Home/Cells/CategoryCell.swift

import UIKit
import SnapKit

/// Ğ¯Ñ‡ĞµĞ¹ĞºĞ° Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
final class CategoryCell: UICollectionViewCell {

    // MARK: - Static

    static let identifier = "CategoryCell"

    // MARK: - UI Elements

    /// Label Ñ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    private let titleLabel: UILabel = {
        let label = UILabel()
        label.font = .systemFont(ofSize: 14, weight: .medium)
        label.textAlignment = .center
        return label
    }()

    // MARK: - Init

    override init(frame: CGRect) {
        super.init(frame: frame)
        setupUI()
    }

    required init?(coder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }

    // MARK: - Setup

    private func setupUI() {
        contentView.layer.cornerRadius = 18
        contentView.layer.borderWidth = 1

        contentView.addSubview(titleLabel)

        titleLabel.snp.makeConstraints { make in
            make.edges.equalToSuperview().inset(UIEdgeInsets(top: 8, left: 16, bottom: 8, right: 16))
        }
    }

    // MARK: - Configure

    /// ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ ÑÑ‡ĞµĞ¹ĞºÑƒ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    /// - Parameters:
    ///   - category: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    ///   - isSelected: Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ° Ğ»Ğ¸ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ
    func configure(with category: String, isSelected: Bool) {
        titleLabel.text = category

        if isSelected {
            // Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ°Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ â€” ÑĞ¸Ğ½Ğ¸Ğ¹ Ñ„Ğ¾Ğ½
            contentView.backgroundColor = .systemBlue
            contentView.layer.borderColor = UIColor.systemBlue.cgColor
            titleLabel.textColor = .white
        } else {
            // ĞĞµĞ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ°Ñ â€” Ğ¿Ñ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½ Ñ Ñ€Ğ°Ğ¼ĞºĞ¾Ğ¹
            contentView.backgroundColor = .clear
            contentView.layer.borderColor = UIColor.systemGray3.cgColor
            titleLabel.textColor = .label
        }
    }

    // MARK: - Reuse

    override func prepareForReuse() {
        super.prepareForReuse()
        titleLabel.text = nil
        contentView.backgroundColor = .clear
    }
}
```

---

## 16.5 FavoriteProduct â€” Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ»Ñ Realm

```swift
// ECommerce/Entities/RealmObjects/FavoriteProduct.swift

import Foundation
import RealmSwift

/// ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ² Realm
/// Realm Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ class, Ğ½Ğ°ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ÑÑ Ğ¾Ñ‚ Object
final class FavoriteProduct: Object {

    // MARK: - Properties

    /// ĞŸĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ â€” ID Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    @Persisted(primaryKey: true) var id: Int = 0

    /// ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    @Persisted var title: String = ""

    /// Ğ¦ĞµĞ½Ğ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    @Persisted var price: Double = 0.0

    /// ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    @Persisted var productDescription: String = ""

    /// ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    @Persisted var category: String = ""

    /// URL Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
    @Persisted var image: String = ""

    /// Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
    @Persisted var ratingRate: Double = 0.0

    /// ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ¾Ğ²
    @Persisted var ratingCount: Int = 0

    // MARK: - Init

    /// ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€ (Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Realm)
    convenience override init() {
        self.init()
    }

    /// Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€ Ğ¸Ğ· Product
    /// - Parameter product: Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ
    convenience init(from product: Product) {
        self.init()
        self.id = product.id
        self.title = product.title
        self.price = product.price
        self.productDescription = product.description
        self.category = product.category
        self.image = product.image
        self.ratingRate = product.rating.rate
        self.ratingCount = product.rating.count
    }

    // MARK: - Conversion

    /// ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾ Ğ² Product
    /// - Returns: Product ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°
    func toProduct() -> Product {
        return Product(
            id: id,
            title: title,
            price: price,
            description: productDescription,
            category: category,
            image: image,
            rating: Product.Rating(
                rate: ratingRate,
                count: ratingCount
            )
        )
    }
}
```

---

## 16.6 Ğ˜Ñ‚Ğ¾Ğ³Ğ¸ Ğ³Ğ»Ğ°Ğ²Ñ‹

Ğ’ ÑÑ‚Ğ¾Ğ¹ Ğ³Ğ»Ğ°Ğ²Ğµ Ğ¼Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ»Ğ¸ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ **Home Module** Ğ¿Ğ¾ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğµ VIPER:

âœ… **Product Entity** â€” Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ñ Codable Ğ¸ computed properties

âœ… **ProductsService** â€” ÑĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ FakeStore API

âœ… **ProductsEndpoint** â€” Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ URL endpoints

âœ… **HomeProtocols** â€” ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² VIPER

âœ… **HomeRouter** â€” ÑĞ±Ğ¾Ñ€ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ¸ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ

âœ… **HomeInteractor** â€” Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°, Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ API Ğ¸ Realm

âœ… **HomePresenter** â€” ÑĞ²ÑĞ·ÑƒÑÑ‰ĞµĞµ Ğ·Ğ²ĞµĞ½Ğ¾, Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

âœ… **HomeViewController** â€” Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ UI

âœ… **ProductCell** â€” ÑÑ‡ĞµĞ¹ĞºĞ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾

âœ… **CategoryCell** â€” ÑÑ‡ĞµĞ¹ĞºĞ° ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸

âœ… **FavoriteProduct** â€” Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Realm Ğ´Ğ»Ñ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ğ¸

1. **VIPER Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ** â€” ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ·Ğ° ÑĞ²Ğ¾Ñ‘:
   - View â†’ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ
   - Presenter â†’ ÑĞ²ÑĞ·ÑŒ Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
   - Interactor â†’ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
   - Router â†’ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ

2. **Dependency Injection** â€” Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¿ĞµÑ€ĞµĞ´Ğ°ÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· init

3. **Protocols** â€” Ğ²ÑĞµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¾Ğ±Ñ‰Ğ°ÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ñ‹

4. **Weak references** â€” View Ğ¸ Output Ğ²ÑĞµĞ³Ğ´Ğ° weak

---

## Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ Ğ³Ğ»Ğ°Ğ²Ğ°

Ğ’ [Ğ“Ğ»Ğ°Ğ²Ğµ 17](../17-Cart/README.md) Ğ¼Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ´Ğ¸Ğ¼ ÑĞºÑ€Ğ°Ğ½ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹.
